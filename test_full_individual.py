"""
Test the full enterprise analyzer with different resumes to check if it produces unique results
"""
import sys
import os
import tempfile
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

def create_test_resumes():
    """Create test resume files with very different content"""
    
    # Expert Python Developer Resume
    python_expert = """
    ALEX RODRIGUEZ
    Senior Python Developer | Machine Learning Engineer
    alex.rodriguez@email.com | (555) 123-4567 | LinkedIn: /in/alexrodriguez
    
    PROFESSIONAL SUMMARY
    Highly skilled Senior Python Developer with 7+ years of experience in developing scalable web applications,
    machine learning systems, and data processing pipelines. Expert in Django, Flask, AWS, and modern ML frameworks.
    
    TECHNICAL SKILLS
    ‚Ä¢ Programming: Python, JavaScript, SQL, Java, Go
    ‚Ä¢ Frameworks: Django, Flask, FastAPI, React, Vue.js
    ‚Ä¢ Machine Learning: TensorFlow, PyTorch, Scikit-learn, Pandas, NumPy
    ‚Ä¢ Cloud Platforms: AWS (EC2, S3, Lambda, RDS), Azure, Google Cloud Platform
    ‚Ä¢ Databases: PostgreSQL, MongoDB, Redis, Elasticsearch
    ‚Ä¢ DevOps: Docker, Kubernetes, Jenkins, Git, CI/CD
    ‚Ä¢ Tools: Jupyter, Apache Spark, Kafka, RabbitMQ
    
    PROFESSIONAL EXPERIENCE
    
    Senior Python Developer | TechCorp Inc. | 2020 - Present
    ‚Ä¢ Lead development of high-traffic web applications serving 2M+ users daily using Django and PostgreSQL
    ‚Ä¢ Built and deployed ML models for recommendation systems increasing user engagement by 35%
    ‚Ä¢ Designed and implemented microservices architecture using Docker and Kubernetes
    ‚Ä¢ Mentored team of 6 junior developers and conducted code reviews
    ‚Ä¢ Optimized database queries reducing response times by 60%
    
    Python Developer | DataSolutions Ltd. | 2018 - 2020
    ‚Ä¢ Developed data processing pipelines handling 100GB+ daily using Apache Spark and Python
    ‚Ä¢ Created REST APIs using Flask serving 10K+ requests per minute
    ‚Ä¢ Implemented automated testing achieving 95% code coverage
    ‚Ä¢ Worked with cross-functional teams in Agile/Scrum environment
    
    Junior Python Developer | StartupXYZ | 2017 - 2018
    ‚Ä¢ Built web scraping tools processing 1M+ records daily
    ‚Ä¢ Developed Django applications with Redis caching
    ‚Ä¢ Participated in daily standups and sprint planning
    
    EDUCATION
    Master of Science in Computer Science | Stanford University | 2017
    Bachelor of Science in Software Engineering | UC Berkeley | 2015
    
    CERTIFICATIONS
    ‚Ä¢ AWS Certified Solutions Architect
    ‚Ä¢ Google Cloud Professional Data Engineer
    ‚Ä¢ Certified Kubernetes Administrator (CKA)
    
    PROJECTS
    ‚Ä¢ E-commerce Platform: Built full-stack application using Django, React, and PostgreSQL
    ‚Ä¢ ML Prediction System: Developed neural network for stock price prediction using TensorFlow
    ‚Ä¢ Real-time Chat Application: Created WebSocket-based chat using Python and Redis
    """
    
    # Junior Marketing Analyst Resume (completely different field)
    marketing_analyst = """
    SARAH JOHNSON
    Marketing Analyst | Digital Marketing Specialist
    sarah.johnson@email.com | (555) 987-6543 | LinkedIn: /in/sarahjohnson
    
    PROFESSIONAL SUMMARY
    Results-driven Marketing Analyst with 2 years of experience in digital marketing campaigns,
    social media management, and brand strategy. Skilled in market research, content creation, and campaign optimization.
    
    CORE COMPETENCIES
    ‚Ä¢ Digital Marketing: SEO, SEM, Social Media Marketing, Email Marketing
    ‚Ä¢ Analytics Tools: Google Analytics, Facebook Insights, Hootsuite, Mailchimp
    ‚Ä¢ Design Software: Canva, Adobe Photoshop, Illustrator (Basic)
    ‚Ä¢ Office Suite: Microsoft Excel, PowerPoint, Word, Google Workspace
    ‚Ä¢ Research: Market Research, Competitor Analysis, Consumer Behavior
    ‚Ä¢ Communication: Content Writing, Copywriting, Presentation Skills
    
    PROFESSIONAL EXPERIENCE
    
    Marketing Analyst | BrandBoost Agency | 2022 - Present
    ‚Ä¢ Managed social media accounts for 15+ clients across Instagram, Facebook, and Twitter
    ‚Ä¢ Increased client engagement rates by 40% through targeted content strategies
    ‚Ä¢ Created weekly performance reports using Google Analytics and social media insights
    ‚Ä¢ Conducted market research for new product launches and brand positioning
    ‚Ä¢ Collaborated with design team to create marketing materials and advertisements
    
    Junior Marketing Coordinator | LocalBiz Solutions | 2021 - 2022
    ‚Ä¢ Assisted in planning and executing digital marketing campaigns for small businesses
    ‚Ä¢ Wrote blog posts and social media content increasing website traffic by 25%
    ‚Ä¢ Organized promotional events and trade show participation
    ‚Ä¢ Maintained customer databases and email marketing lists
    
    Marketing Intern | Creative Media Group | Summer 2021
    ‚Ä¢ Supported senior marketers in campaign development and execution
    ‚Ä¢ Conducted competitive analysis and market research
    ‚Ä¢ Created social media content and managed posting schedules
    ‚Ä¢ Learned basic graphic design and video editing skills
    
    EDUCATION
    Bachelor of Arts in Marketing | University of California, Los Angeles | 2021
    Minor in Communications
    
    CERTIFICATIONS
    ‚Ä¢ Google Analytics Certified
    ‚Ä¢ Facebook Blueprint Certification
    ‚Ä¢ HubSpot Content Marketing Certification
    
    PROJECTS
    ‚Ä¢ Social Media Campaign: Led Instagram campaign for local restaurant resulting in 200% follower increase
    ‚Ä¢ Market Research Study: Conducted consumer behavior analysis for startup beauty brand
    ‚Ä¢ Email Marketing Campaign: Designed email sequence achieving 15% open rate improvement
    
    AWARDS
    ‚Ä¢ Dean's List (3 semesters)
    ‚Ä¢ Outstanding Marketing Student Award 2021
    """
    
    # Job Description for Senior Python Developer
    job_description = """
    SENIOR PYTHON DEVELOPER
    TechInnovate Solutions | San Francisco, CA | Full-time
    
    COMPANY OVERVIEW
    TechInnovate Solutions is a leading technology company specializing in AI-powered enterprise solutions.
    We serve Fortune 500 companies and process billions of data points daily.
    
    JOB DESCRIPTION
    We are seeking a highly skilled Senior Python Developer to join our engineering team. The ideal candidate
    will have extensive experience in Python development, machine learning, and cloud technologies.
    
    KEY RESPONSIBILITIES
    ‚Ä¢ Design and develop scalable Python applications and APIs
    ‚Ä¢ Build and deploy machine learning models for production systems
    ‚Ä¢ Lead architecture decisions for microservices and distributed systems
    ‚Ä¢ Mentor junior developers and conduct technical code reviews
    ‚Ä¢ Collaborate with product managers and data scientists on feature development
    ‚Ä¢ Optimize application performance and ensure high availability
    ‚Ä¢ Implement CI/CD pipelines and automated testing frameworks
    
    REQUIRED QUALIFICATIONS
    ‚Ä¢ 5+ years of professional Python development experience
    ‚Ä¢ Strong expertise in Django, Flask, or FastAPI frameworks
    ‚Ä¢ Experience with machine learning libraries (TensorFlow, PyTorch, Scikit-learn)
    ‚Ä¢ Proficiency in cloud platforms (AWS, Azure, or GCP)
    ‚Ä¢ Solid understanding of databases (PostgreSQL, MongoDB, Redis)
    ‚Ä¢ Experience with containerization (Docker) and orchestration (Kubernetes)
    ‚Ä¢ Knowledge of version control (Git) and CI/CD pipelines
    ‚Ä¢ Strong problem-solving skills and ability to work in Agile environment
    
    PREFERRED QUALIFICATIONS
    ‚Ä¢ Master's degree in Computer Science or related field
    ‚Ä¢ Experience with big data technologies (Spark, Kafka, Hadoop)
    ‚Ä¢ Knowledge of DevOps practices and tools
    ‚Ä¢ AWS/Azure/GCP certifications
    ‚Ä¢ Experience leading technical teams
    ‚Ä¢ Contributions to open-source projects
    
    TECHNICAL REQUIREMENTS
    ‚Ä¢ Python 3.x expertise
    ‚Ä¢ RESTful API design and development
    ‚Ä¢ Microservices architecture
    ‚Ä¢ Database design and optimization
    ‚Ä¢ Unit testing and TDD practices
    ‚Ä¢ Performance monitoring and optimization
    
    WHAT WE OFFER
    ‚Ä¢ Competitive salary: $150,000 - $200,000 based on experience
    ‚Ä¢ Comprehensive health, dental, and vision insurance
    ‚Ä¢ 401(k) with company matching
    ‚Ä¢ Flexible work arrangements and remote work options
    ‚Ä¢ Professional development budget and conference attendance
    ‚Ä¢ Stock options and performance bonuses
    ‚Ä¢ Collaborative and innovative work environment
    """
    
    # Create temporary files
    temp_dir = tempfile.mkdtemp()
    
    files = {}
    files['python_expert'] = os.path.join(temp_dir, 'alex_python_senior.txt')
    files['marketing_analyst'] = os.path.join(temp_dir, 'sarah_marketing.txt')
    files['job_description'] = os.path.join(temp_dir, 'senior_python_job.txt')
    
    with open(files['python_expert'], 'w', encoding='utf-8') as f:
        f.write(python_expert)
    
    with open(files['marketing_analyst'], 'w', encoding='utf-8') as f:
        f.write(marketing_analyst)
        
    with open(files['job_description'], 'w', encoding='utf-8') as f:
        f.write(job_description)
    
    return files

def test_full_enterprise_analyzer():
    """Test the full enterprise analyzer with different resumes"""
    
    try:
        print("üîÑ Testing Full Enterprise Analyzer with Different Resumes...")
        
        # Import the full analyzer
        from src.resume_analyzer import ResumeAnalyzer
        from config.settings import get_config
        
        config = get_config()
        analyzer = ResumeAnalyzer(config)
        
        print("‚úÖ Full enterprise analyzer initialized")
        
        # Create test files
        test_files = create_test_resumes()
        print("üìù Created test resume files")
        
        print("\n" + "="*70)
        print("üß™ TESTING PYTHON EXPERT vs PYTHON JOB")
        print("="*70)
        
        python_results = analyzer.analyze_resume_for_job(
            test_files['python_expert'], 
            test_files['job_description'], 
            save_to_db=False
        )
        
        python_score = python_results['analysis_results']['overall_score']
        python_match = python_results['analysis_results']['match_level']
        python_name = python_results['resume_data'].get('candidate_name', 'Unknown')
        python_skills = python_results['resume_data'].get('skills', [])
        
        print(f"üë§ Candidate: {python_name}")
        print(f"üìä Overall Score: {python_score:.2f}")
        print(f"üéØ Match Level: {python_match}")
        print(f"üîß Skills Found: {len(python_skills)} ({', '.join(python_skills[:5])}...)")
        
        print("\n" + "="*70)
        print("üß™ TESTING MARKETING ANALYST vs PYTHON JOB")
        print("="*70)
        
        marketing_results = analyzer.analyze_resume_for_job(
            test_files['marketing_analyst'],
            test_files['job_description'], 
            save_to_db=False
        )
        
        marketing_score = marketing_results['analysis_results']['overall_score']
        marketing_match = marketing_results['analysis_results']['match_level']
        marketing_name = marketing_results['resume_data'].get('candidate_name', 'Unknown')
        marketing_skills = marketing_results['resume_data'].get('skills', [])
        
        print(f"üë§ Candidate: {marketing_name}")
        print(f"üìä Overall Score: {marketing_score:.2f}")
        print(f"üéØ Match Level: {marketing_match}")
        print(f"üîß Skills Found: {len(marketing_skills)} ({', '.join(marketing_skills[:5])}...)")
        
        print("\n" + "="*70)
        print("üìà ANALYSIS COMPARISON")
        print("="*70)
        
        score_difference = abs(python_score - marketing_score)
        print(f"Score Difference: {score_difference:.2f} points")
        
        # Check detailed results
        print(f"\nPython Expert Detailed Scores:")
        hard_matching = python_results['detailed_results'].get('hard_matching', {})
        print(f"  - Hard Matching: {hard_matching.get('overall_score', 0):.1f}")
        print(f"  - Skills Score: {hard_matching.get('skills_score', 0):.1f}")
        print(f"  - Keywords Score: {hard_matching.get('keyword_score', 0):.1f}")
        
        print(f"\nMarketing Analyst Detailed Scores:")
        hard_matching_m = marketing_results['detailed_results'].get('hard_matching', {})
        print(f"  - Hard Matching: {hard_matching_m.get('overall_score', 0):.1f}")
        print(f"  - Skills Score: {hard_matching_m.get('skills_score', 0):.1f}")
        print(f"  - Keywords Score: {hard_matching_m.get('keyword_score', 0):.1f}")
        
        # Determine if working correctly
        if score_difference > 15 and python_score > marketing_score:
            print(f"\n‚úÖ SUCCESS: Analyzer correctly differentiates!")
            print(f"   Python Expert: {python_score:.1f} > Marketing Analyst: {marketing_score:.1f}")
            success = True
        else:
            print(f"\n‚ùå ISSUE: Scores too similar or incorrect ranking")
            print(f"   Expected: Python Expert > Marketing Analyst")
            print(f"   Actual: Python Expert {python_score:.1f}, Marketing Analyst {marketing_score:.1f}")
            success = False
        
        # Clean up
        import shutil
        shutil.rmtree(os.path.dirname(test_files['python_expert']))
        
        return success
        
    except Exception as e:
        print(f"‚ùå Test failed: {e}")
        import traceback
        traceback.print_exc()
        return False

if __name__ == "__main__":
    print("üöÄ Testing Full Enterprise Resume Analyzer for Individual Results...")
    success = test_full_enterprise_analyzer()
    if success:
        print("\nüéâ Full enterprise analyzer is working correctly!")
    else:
        print("\nüí• Full enterprise analyzer needs fixes!")